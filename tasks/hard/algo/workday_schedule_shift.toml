level             = "hard"
name              = "workday_schedule_shift"
tags              = ["algo", "intervals", "greedy", "scheduling", "string", "time"]
time_to_solve_sec = 900

description_en = """
Workday is from **09:00** to **18:00**.

You are given an **ordered**, non-overlapping schedule `meetings` of time intervals in the form `[['HH:MM','HH:MM'], ...]`
and a new interval `meeting` of the same form.
Insert the new meeting by shifting **forward** only those existing meetings that overlap it (and any that subsequently overlap shifted ones), forming a forward **chain**.
Return the new schedule including the inserted meeting, in chronological order.

It is guaranteed that the insertion is always feasible within the same day and nothing goes past **18:00**.
"""

description_ru = """
Рабочий день: **09:00–18:00**.

Дано **упорядоченное**, непересекающееся расписание `meetings` из интервалов вида `[['HH:MM','HH:MM'], ...]`
и новый интервал `meeting`.
Вставьте новую встречу, сдвигая **вперёд** только те встречи, которые с ней пересекаются (а также те, что далее пересекутся со сдвинутыми), образуя цепочку сдвигов.
Верните новое расписание с вставленной встречей в хронологическом порядке.

Гарантируется, что вставка всегда выполнима в рамках дня и ничего не выходит за **18:00**.
"""

solution = """
def solution(meetings, meeting):
    to_min = lambda t: int(t[:2]) * 60 + int(t[3:])
    to_str = lambda m: f"{m//60:02}:{m%60:02}"

    sched = [[to_min(s), to_min(e)] for s, e in meetings]
    ns, ne = to_min(meeting[0]), to_min(meeting[1])

    res, i, n = [], 0, len(sched)

    # Keep all meetings that end no later than the new start
    while i < n and sched[i][1] <= ns:
        res.append(sched[i]); i += 1

    # Start the forward shift chain with the new meeting
    chain = [[ns, ne]]

    # Extend the chain while next meeting starts before current chain end
    while i < n and sched[i][0] < chain[-1][1]:
        dur = sched[i][1] - sched[i][0]
        start = chain[-1][1]
        chain.append([start, start + dur])
        i += 1

    res += chain
    res += sched[i:]

    # Return as HH:MM strings, sorted chronologically
    res.sort()
    return [[to_str(s), to_str(e)] for s, e in res]
"""

examples = """
solution(
  [
    ['10:00','11:00'],
    ['11:00','12:00']
  ],
  ['10:30','11:30']
) == [
  ['10:30','11:30'],
  ['11:30','12:30'],
  ['12:30','13:30']
]
"""

[[input_signature]]
argument_name = "meetings"
[input_signature.type]
name = "array"
[input_signature.type.nested]
name = "array"
[input_signature.type.nested.nested]
name = "string"

[[input_signature]]
argument_name = "meeting"
[input_signature.type]
name = "array"
[input_signature.type.nested]
name = "string"

[output_signature.type]
name = "array"
[output_signature.type.nested]
name = "array"
[output_signature.type.nested.nested]
name = "string"

# --- Test cases ---

[[asserts]]
arguments = [[["10:05", "11:05"]], ["10:35", "11:35"]]
expected  = [["10:35", "11:35"], ["11:35", "12:35"]]

[[asserts]]
arguments = [[["10:05", "11:05"]], ["11:35", "12:35"]]
expected  = [["10:05", "11:05"], ["11:35", "12:35"]]

[[asserts]]
arguments = [[["14:05", "15:05"], ["15:35", "16:05"]], ["14:35", "15:35"]]
expected  = [["14:35", "15:35"], ["15:35", "16:35"], ["16:35", "17:05"]]

[[asserts]]
arguments = [[["09:05", "10:05"], ["14:05", "15:05"]], ["10:05", "14:05"]]
expected  = [["09:05", "10:05"], ["10:05", "14:05"], ["14:05", "15:05"]]

[[asserts]]
arguments = [[["10:05", "11:05"], ["11:05", "12:05"]], ["10:35", "11:35"]]
expected  = [["10:35", "11:35"], ["11:35", "12:35"], ["12:35", "13:35"]]

[[asserts]]
arguments = [
  [
    [
      "09:05",
      "10:05",
    ],
    [
      "14:05",
      "15:05",
    ],
    [
      "16:05",
      "17:05",
    ],
  ],
  [
    "10:05",
    "11:05",
  ],
]
expected = [
  [
    "09:05",
    "10:05",
  ],
  [
    "10:05",
    "11:05",
  ],
  [
    "14:05",
    "15:05",
  ],
  [
    "16:05",
    "17:05",
  ],
]

[[asserts]]
arguments = [[["09:05", "10:05"]], ["09:35", "10:35"]]
expected  = [["09:35", "10:35"], ["10:35", "11:35"]]

[[asserts]]
arguments = [[], ["09:05", "10:05"]]
expected  = [["09:05", "10:05"]]

[[asserts]]
arguments = [[["09:05", "10:05"]], ["17:05", "18:00"]]
expected  = [["09:05", "10:05"], ["17:05", "18:00"]]

[[asserts]]
arguments = [[["09:10", "10:10"], ["10:15", "11:15"]], ["09:15", "10:15"]]
expected  = [["09:15", "10:15"], ["10:15", "11:15"], ["11:15", "12:15"]]

[[asserts]]
arguments = [[["09:15", "10:15"], ["10:20", "11:20"]], ["11:25", "12:25"]]
expected  = [["09:15", "10:15"], ["10:20", "11:20"], ["11:25", "12:25"]]

[[asserts]]
arguments = [
  [
    [
      "09:20",
      "10:20",
    ],
    [
      "10:25",
      "11:25",
    ],
    [
      "11:30",
      "12:30",
    ],
  ],
  [
    "10:35",
    "11:35",
  ],
]
expected = [
  [
    "09:20",
    "10:20",
  ],
  [
    "10:35",
    "11:35",
  ],
  [
    "11:35",
    "12:35",
  ],
  [
    "12:35",
    "13:35",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:25",
      "10:25",
    ],
    [
      "10:30",
      "11:30",
    ],
    [
      "11:35",
      "12:35",
    ],
  ],
  [
    "09:40",
    "10:40",
  ],
]
expected = [
  [
    "09:40",
    "10:40",
  ],
  [
    "10:40",
    "11:40",
  ],
  [
    "11:40",
    "12:40",
  ],
  [
    "12:40",
    "13:40",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:30",
      "10:30",
    ],
    [
      "10:35",
      "11:35",
    ],
    [
      "11:40",
      "12:40",
    ],
  ],
  [
    "11:45",
    "12:45",
  ],
]
expected = [
  [
    "09:30",
    "10:30",
  ],
  [
    "10:35",
    "11:35",
  ],
  [
    "11:45",
    "12:45",
  ],
  [
    "12:45",
    "13:45",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:35",
      "10:35",
    ],
    [
      "10:40",
      "11:40",
    ],
    [
      "11:45",
      "12:45",
    ],
  ],
  [
    "12:50",
    "13:50",
  ],
]
expected = [
  [
    "09:35",
    "10:35",
  ],
  [
    "10:40",
    "11:40",
  ],
  [
    "11:45",
    "12:45",
  ],
  [
    "12:50",
    "13:50",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:40",
      "10:40",
    ],
    [
      "10:45",
      "11:45",
    ],
    [
      "11:50",
      "12:50",
    ],
  ],
  [
    "08:05",
    "09:05",
  ],
]
expected = [
  [
    "08:05",
    "09:05",
  ],
  [
    "09:40",
    "10:40",
  ],
  [
    "10:45",
    "11:45",
  ],
  [
    "11:50",
    "12:50",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:45",
      "10:45",
    ],
    [
      "10:50",
      "11:50",
    ],
    [
      "11:55",
      "12:55",
    ],
  ],
  [
    "08:35",
    "09:35",
  ],
]
expected = [
  [
    "08:35",
    "09:35",
  ],
  [
    "09:45",
    "10:45",
  ],
  [
    "10:50",
    "11:50",
  ],
  [
    "11:55",
    "12:55",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:50",
      "10:50",
    ],
    [
      "10:55",
      "11:55",
    ],
    [
      "12:00",
      "13:00",
    ],
  ],
  [
    "13:05",
    "14:05",
  ],
]
expected = [
  [
    "09:50",
    "10:50",
  ],
  [
    "10:55",
    "11:55",
  ],
  [
    "12:00",
    "13:00",
  ],
  [
    "13:05",
    "14:05",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:55",
      "10:55",
    ],
    [
      "11:00",
      "12:00",
    ],
    [
      "12:05",
      "13:05",
    ],
  ],
  [
    "13:10",
    "14:10",
  ],
]
expected = [
  [
    "09:55",
    "10:55",
  ],
  [
    "11:00",
    "12:00",
  ],
  [
    "12:05",
    "13:05",
  ],
  [
    "13:10",
    "14:10",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:10",
      "10:10",
    ],
    [
      "10:15",
      "11:15",
    ],
    [
      "11:20",
      "12:20",
    ],
  ],
  [
    "09:15",
    "12:15",
  ],
]
expected = [
  [
    "09:15",
    "12:15",
  ],
  [
    "12:15",
    "13:15",
  ],
  [
    "13:15",
    "14:15",
  ],
  [
    "14:15",
    "15:15",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:15",
      "10:15",
    ],
    [
      "10:20",
      "11:20",
    ],
    [
      "11:25",
      "12:25",
    ],
    [
      "12:30",
      "13:30",
    ],
  ],
  [
    "10:35",
    "11:35",
  ],
]
expected = [
  [
    "09:15",
    "10:15",
  ],
  [
    "10:35",
    "11:35",
  ],
  [
    "11:35",
    "12:35",
  ],
  [
    "12:35",
    "13:35",
  ],
  [
    "13:35",
    "14:35",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:20",
      "10:20",
    ],
    [
      "10:25",
      "11:25",
    ],
    [
      "11:30",
      "12:30",
    ],
    [
      "12:35",
      "13:35",
    ],
  ],
  [
    "11:35",
    "12:35",
  ],
]
expected = [
  [
    "09:20",
    "10:20",
  ],
  [
    "10:25",
    "11:25",
  ],
  [
    "11:35",
    "12:35",
  ],
  [
    "12:35",
    "13:35",
  ],
  [
    "13:35",
    "14:35",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:25",
      "10:25",
    ],
    [
      "10:30",
      "11:30",
    ],
    [
      "11:35",
      "12:35",
    ],
    [
      "12:40",
      "13:40",
    ],
  ],
  [
    "13:45",
    "14:45",
  ],
]
expected = [
  [
    "09:25",
    "10:25",
  ],
  [
    "10:30",
    "11:30",
  ],
  [
    "11:35",
    "12:35",
  ],
  [
    "12:40",
    "13:40",
  ],
  [
    "13:45",
    "14:45",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:30",
      "10:30",
    ],
    [
      "10:35",
      "11:35",
    ],
    [
      "11:40",
      "12:40",
    ],
    [
      "12:45",
      "13:45",
    ],
  ],
  [
    "14:50",
    "15:50",
  ],
]
expected = [
  [
    "09:30",
    "10:30",
  ],
  [
    "10:35",
    "11:35",
  ],
  [
    "11:40",
    "12:40",
  ],
  [
    "12:45",
    "13:45",
  ],
  [
    "14:50",
    "15:50",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:35",
      "10:35",
    ],
    [
      "10:40",
      "11:40",
    ],
    [
      "11:45",
      "12:45",
    ],
    [
      "12:50",
      "13:50",
    ],
  ],
  [
    "08:05",
    "09:05",
  ],
]
expected = [
  [
    "08:05",
    "09:05",
  ],
  [
    "09:35",
    "10:35",
  ],
  [
    "10:40",
    "11:40",
  ],
  [
    "11:45",
    "12:45",
  ],
  [
    "12:50",
    "13:50",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:40",
      "10:40",
    ],
    [
      "10:45",
      "11:45",
    ],
    [
      "11:50",
      "12:50",
    ],
    [
      "12:55",
      "13:55",
    ],
  ],
  [
    "08:35",
    "09:35",
  ],
]
expected = [
  [
    "08:35",
    "09:35",
  ],
  [
    "09:40",
    "10:40",
  ],
  [
    "10:45",
    "11:45",
  ],
  [
    "11:50",
    "12:50",
  ],
  [
    "12:55",
    "13:55",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:45",
      "10:45",
    ],
    [
      "10:50",
      "11:50",
    ],
    [
      "11:55",
      "12:55",
    ],
    [
      "13:00",
      "14:00",
    ],
  ],
  [
    "14:05",
    "15:05",
  ],
]
expected = [
  [
    "09:45",
    "10:45",
  ],
  [
    "10:50",
    "11:50",
  ],
  [
    "11:55",
    "12:55",
  ],
  [
    "13:00",
    "14:00",
  ],
  [
    "14:05",
    "15:05",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:50",
      "10:50",
    ],
    [
      "10:55",
      "11:55",
    ],
    [
      "12:00",
      "13:00",
    ],
    [
      "13:05",
      "14:05",
    ],
  ],
  [
    "14:40",
    "15:40",
  ],
]
expected = [
  [
    "09:50",
    "10:50",
  ],
  [
    "10:55",
    "11:55",
  ],
  [
    "12:00",
    "13:00",
  ],
  [
    "13:05",
    "14:05",
  ],
  [
    "14:40",
    "15:40",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:55",
      "10:55",
    ],
    [
      "11:00",
      "12:00",
    ],
    [
      "12:05",
      "13:05",
    ],
    [
      "13:10",
      "14:10",
    ],
  ],
  [
    "15:15",
    "16:15",
  ],
]
expected = [
  [
    "09:55",
    "10:55",
  ],
  [
    "11:00",
    "12:00",
  ],
  [
    "12:05",
    "13:05",
  ],
  [
    "13:10",
    "14:10",
  ],
  [
    "15:15",
    "16:15",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:05",
      "10:05",
    ],
    [
      "10:10",
      "11:10",
    ],
    [
      "11:15",
      "12:15",
    ],
    [
      "12:20",
      "13:20",
    ],
  ],
  [
    "16:25",
    "17:25",
  ],
]
expected = [
  [
    "09:05",
    "10:05",
  ],
  [
    "10:10",
    "11:10",
  ],
  [
    "11:15",
    "12:15",
  ],
  [
    "12:20",
    "13:20",
  ],
  [
    "16:25",
    "17:25",
  ],
]

[[asserts]]
arguments = [
  [
    [
      "09:10",
      "10:10",
    ],
    [
      "10:15",
      "11:15",
    ],
    [
      "11:20",
      "12:20",
    ],
    [
      "12:25",
      "13:25",
    ],
  ],
  [
    "17:30",
    "18:00",
  ],
]
expected = [
  [
    "09:10",
    "10:10",
  ],
  [
    "10:15",
    "11:15",
  ],
  [
    "11:20",
    "12:20",
  ],
  [
    "12:25",
    "13:25",
  ],
  [
    "17:30",
    "18:00",
  ],
]

[[asserts]]
arguments = [[["09:15", "10:15"], ["10:20", "11:20"]], ["09:35", "10:35"]]
expected  = [["09:35", "10:35"], ["10:35", "11:35"], ["11:35", "12:35"]]

[[asserts]]
arguments = [
  [
    [
      "09:20",
      "10:20",
    ],
    [
      "10:25",
      "11:25",
    ],
    [
      "11:30",
      "12:30",
    ],
  ],
  [
    "09:40",
    "10:40",
  ],
]
expected = [
  [
    "09:40",
    "10:40",
  ],
  [
    "10:40",
    "11:40",
  ],
  [
    "11:40",
    "12:40",
  ],
  [
    "12:40",
    "13:40",
  ],
]
